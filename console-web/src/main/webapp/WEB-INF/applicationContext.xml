<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:osgi="http://www.springframework.org/schema/osgi"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:jaxws="http://cxf.apache.org/jaxws"
       xmlns:jaxrs="http://cxf.apache.org/jaxrs"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                    http://www.springframework.org/schema/beans/spring-beans.xsd
                    http://www.springframework.org/schema/context
	                http://www.springframework.org/schema/context/spring-context.xsd
                    http://www.springframework.org/schema/osgi
                    http://www.springframework.org/schema/osgi/spring-osgi.xsd
                    http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
                    http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd">

    <import resource="applicationContextExt.xml"/>

    <import resource="classpath:META-INF/cxf/cxf.xml"/>
    <import resource="classpath:META-INF/cxf/cxf-extension-soap.xml"/>
    <import resource="classpath:META-INF/cxf/cxf-extension-jaxrs-binding.xml"/>
    <import resource="classpath:META-INF/cxf/cxf-servlet.xml"/>


    <!-- ==================================================================== -->
    <!-- Idbus Server Management OSGI Services                                -->
    <!-- ==================================================================== -->
    
    <osgi:reference id="serviceConfigurationManager" cardinality="1..1" timeout="60"
                    interface="com.atricore.idbus.console.settings.main.spi.ServiceConfigurationManager"/>

    <osgi:reference id="idApplianceManagementService" cardinality="1..1" timeout="60"
                    interface="com.atricore.idbus.console.lifecycle.main.spi.IdentityApplianceManagementService"/>
                               
    <osgi:reference id="activationServiceBean" cardinality="1..1" timeout="60"
                    interface="com.atricore.idbus.console.activation.main.spi.ActivationService"/>

    <osgi:reference id="licenseManagementService" cardinality="1..1" timeout="60"
                    interface="com.atricore.idbus.console.licensing.main.LicenseManager"/>

    <osgi:reference id="brandManager" cardinality="1..1" timeout="60"
                    interface="com.atricore.idbus.console.brandservice.main.spi.BrandManager"/>

    <osgi:list id="spmlServiceBeans" interface="org.atricore.idbus.capabilities.spmlr2.main.SpmlR2Client"
               cardinality="0..N" >
        <osgi:listener ref="spml-service-listener" bind-method="register" unbind-method="unregister"/>
    </osgi:list>

    <bean name="spml-service-listener" class="com.atricore.idbus.console.services.impl.SpmlR2ServiceListener">
        <property name="services">
            <list>
                <ref bean="userProvisioningAjaxServiceBean"/>
                <ref bean="profileManagementAjaxServiceBean"/>
                <ref bean="schemaManagementAjaxServiceBean"/>
            </list>
        </property>
    </bean>

    <bean class="com.atricore.idbus.console.services.util.EnumPropertyProxy" factory-method="registerPropertyProxy" />

    <bean id="dozerMapper" class="org.dozer.DozerBeanMapper">
        <property name="mappingFiles">
            <list>
                <value>com/atricore/idbus/console/services/dto/dozer-mappings.xml</value>
            </list>
        </property>
    </bean>

    <!-- AJAX SERVICES -->

    <bean id="identityApplianceManagementAjaxServiceBean" class="com.atricore.idbus.console.services.impl.IdentityApplianceManagementAjaxServiceImpl">
        <property name="idApplianceManagementService" ref="idApplianceManagementService"/>
        <property name="dozerMapper" ref="dozerMapper" />
    </bean>
    
    <bean id="serviceConfigurationManagerAjaxServiceBean" class="com.atricore.idbus.console.services.impl.ServiceConfigurationManagerAjaxServcieImpl">
        <property name="cfgManager" ref="serviceConfigurationManager"/>
        <property name="dozerMapper" ref="dozerMapper" />
    </bean>

    <bean id="activationAjaxServiceBean" class="com.atricore.idbus.console.services.impl.ActivationAjaxServiceImpl">
        <property name="activationService" ref="activationServiceBean"/>
        <property name="dozerMapper" ref="dozerMapper" />
    </bean>

    <bean id="userProvisioningAjaxServiceBean"
          class="com.atricore.idbus.console.services.impl.UserProvisioningAjaxServiceImpl">
        <!-- TODO : Expose through OSGi config support -->
        <property name="pspTargetId" value="pst-default" />
    </bean>

    <bean id="schemaManagementAjaxServiceBean"
          class="com.atricore.idbus.console.services.impl.SchemaManagementAjaxServiceImpl">
        <property name="pspTargetId" value="pst-default" />
    </bean>

    <bean id="brandManagerAjaxServiceBean" class="com.atricore.idbus.console.services.impl.BrandManagerAjaxServiceImpl">
        <property name="brandManager" ref="brandManager"/>
        <property name="dozerMapper" ref="dozerMapper" />
    </bean>

    <bean id="applicationServerInitialization" init-method="init"
          class="com.atricore.idbus.console.services.util.ApplicationServerInitialization">
        <property name="usrProvService" ref="userProvisioningAjaxServiceBean" />
        <property name="adminGroupName" value="Administrators" />
        <property name="adminGroupDescription" value="Administrators" />
        <property name="adminUsername" value="admin" />
        <property name="adminPassword" value="admin" />
        <property name="adminName" value="Administrator" />
        <property name="adminLastName" value="Administrator" />
        <property name="adminFullName" value="Administrator" />
    </bean>

    <bean id="signOnAjaxServiceBean" class="com.atricore.idbus.console.services.impl.SignOnAjaxServiceImpl">
        <property name="usrProvService" ref="userProvisioningAjaxServiceBean" />
        <property name="realm" value="atricore" />
    </bean>

    <bean id="profileManagementAjaxServiceBean" class="com.atricore.idbus.console.services.impl.ProfileManagementAjaxServiceImpl">
        <property name="usrProvService" ref="userProvisioningAjaxServiceBean" />
        <property name="pspTargetId" value="pst-default" />
    </bean>

    <!--bean id="uploadHandler" class="com.atricore.idbus.console.web.servlets.UploadServletHandler">
        <property name="idApplianceManagementService" ref="idApplianceManagementService"/>
    </bean-->

    <bean id="licenseManagementAjaxServiceBean" class="com.atricore.idbus.console.services.impl.LicenseManagementAjaxServiceImpl">
        <property name="licenseManager" ref="licenseManagementService"/>
        <property name="dozerMapper" ref="dozerMapper" />
    </bean>


    <osgi:reference id="activationWService"
                    interface="com.atricore.idbus.console.activation._1_0.wsdl.ActivationPortType"
                    cardinality="1..1" timeout="30" />

    <!-- SOAP Services -->
    <jaxws:server id="activationWServcieServer"
                  serviceClass="com.atricore.idbus.console.activation._1_0.wsdl.ActivationPortType"
            address="/activation">
        <jaxws:serviceBean>
			<bean class="com.atricore.idbus.console.web.util.ActivationPortTypeWrapper">
                <property name="wrapped" ref="activationWService"/>
            </bean>
		</jaxws:serviceBean>
    </jaxws:server >


    <context:component-scan base-package="com.atricore.idbus.console.web" />

    <context:annotation-config />
    
</beans>
