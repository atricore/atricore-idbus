<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns:osgi="http://www.springframework.org/schema/osgi"
xmlns:osgix="http://www.springframework.org/schema/osgi-compendium"
xmlns:ctx="http://www.springframework.org/schema/context"
xsi:schemaLocation="http://www.springframework.org/schema/beans
                    http://www.springframework.org/schema/beans/spring-beans.xsd
                    http://www.springframework.org/schema/osgi
                    http://www.springframework.org/schema/osgi/spring-osgi.xsd
                    http://www.springframework.org/schema/context
                    http://www.springframework.org/schema/context/spring-context.xsd
                    http://www.springframework.org/schema/osgi-compendium
                    http://www.springframework.org/schema/osgi-compendium/spring-osgi-compendium.xsd
                    ">

    <!-- OSGi services export -->
    <osgi:service id="idau-default-exporter" ref="idau-default"
                  interface="org.atricore.idbus.kernel.main.mediation.osgi.OsgiIdentityMediationUnit" />

    <osgi:service id="osgi-psp-default-client"
                  ref="psp-default-client"
                  interface="org.atricore.idbus.capabilities.spmlr2.main.SpmlR2Client"/>

    <osgi:service id="osgi-idstore-default"
                  ref="idstore-default"
                  interface="org.atricore.idbus.kernel.main.store.identity.IdentityPartitionStore">
        <service-properties>
            <!-- This MUST match the Identity Connector Bean property named 'storeName' -->
            <entry key="storeName" value="store-default"/>
        </service-properties>
    </osgi:service>

    <osgi:service id="osgi-pst-default"
                  ref="pst-default"
                  interface="org.atricore.idbus.kernel.main.provisioning.spi.ProvisioningTarget">

        <service-properties>
            <!-- This MUST match the PST Bean property named 'name' -->
            <entry key="pstName" value="pst-default"/>
        </service-properties>
    </osgi:service>

    <osgi:service id="osgi-connector-default"
                  ref="connector-default"
                  interface="org.atricore.idbus.kernel.main.provisioning.spi.IdentityConnector"/>


    <!-- Export Default JDBC DS as OSGi service -->
    <osgi:service id="osgi-default-ds" ref="josso-ds"
                  interface="javax.sql.DataSource" >
        <service-properties>
            <entry key="jdbcDS" value="default-ds"/>
        </service-properties>
    </osgi:service>

    <!-- OSGi services import -->

    <osgi:reference id="cxf" cardinality="1..1" timeout="60" interface="org.apache.cxf.Bus"/>

    <osgi:reference id="bpms-manager" cardinality="1..1" timeout="60" 
                    interface="org.atricore.idbus.kernel.planning.jbpm.BPMSManager" />

    <!--
    <osgi:reference id="idau-default-aqm" cardinality="1..1" timeout="60"
                    interface="org.atricore.idbus.kernel.main.mediation.MessageQueueManager" />
    -->
    <osgi:reference id="artifactQueueManager" cardinality="1..1" timeout="60"
                    interface="org.atricore.idbus.kernel.main.mediation.MessageQueueManager" />

    <osgi:reference id="cache-manager-factory" cardinality="1..1" timeout="60"
                  interface="org.atricore.idbus.bundles.ehcache.CacheManagerFactory"/>

    <osgi:reference id="idbus-config" interface="org.atricore.idbus.kernel.main.util.ConfigurationContext"/>

    <osgi:reference id="jdbcDriverManager" timeout="60" cardinality="1..1"
                    interface="org.atricore.idbus.kernel.common.support.jdbc.JDBCDriverManager"/>

</beans>